syntax = "proto3";

package ose.datos.infraestructura;

import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/any.proto";
import "auxiliares.proto";

message ISnapshotClimatico {
  string timestamp = 1;
  optional double temperatura = 2;
  optional double humedad = 3;
  optional double precipitacion = 4;
  optional double presionAtmosferica = 5;
  optional double velocidadViento = 6;
  optional double direccionViento = 7;
  optional double coberturaNubes = 8;
  optional double indiceUV = 9;
  optional double sensacionTermica = 10;
}

message IEstacionClimaticaVirtual {
  optional string _id = 1;
  string idCliente = 2;
  optional string idDivision = 3;
  optional string idJefatura = 4;
  string nombre = 5;
  optional string codigo = 6;
  optional string descripcion = 7;
  IUbicacionGeografica ubicacion = 8;
  double radioCoberturaKm = 9;
  string idFuenteDatos = 10;
  double frecuenciaPollingMinutos = 11;
  optional string ultimaActualizacion = 12;
  optional string proximaActualizacionProgramada = 13;
  optional ISnapshotClimatico ultimaLectura = 14;
  string estado = 15;
  string creadoPor = 16;
  optional string idPuntoMedicionOrigen = 17;
  optional string ultimoErrorApi = 18;
  optional double contadorErroresConsecutivos = 19;
  optional string fechaCreacion = 20;
  optional string fechaDesactivacion = 21;
  optional google.protobuf.Any cliente = 22;
  optional google.protobuf.Any division = 23;
  optional google.protobuf.Any jefatura = 24;
  optional google.protobuf.Any fuenteDatos = 25;
  optional double puntosAsociadosCount = 26;
}

message ICreateEstacionClimaticaVirtual {
  string idCliente = 1;
  string nombre = 2;
  IUbicacionGeografica ubicacion = 3;
  double radioCoberturaKm = 4;
  string idFuenteDatos = 5;
  double frecuenciaPollingMinutos = 6;
  string estado = 7;
  string creadoPor = 8;
  optional string idDivision = 9;
  optional string idJefatura = 10;
  optional string codigo = 11;
  optional string descripcion = 12;
  optional string ultimaActualizacion = 13;
  optional string proximaActualizacionProgramada = 14;
  optional string idPuntoMedicionOrigen = 15;
}

message IUpdateEstacionClimaticaVirtual {
  optional ISnapshotClimatico ultimaLectura = 1;
  optional string ultimoErrorApi = 2;
  optional double contadorErroresConsecutivos = 3;
  optional string fechaDesactivacion = 4;
  optional string idCliente = 5;
  optional string idDivision = 6;
  optional string idJefatura = 7;
  optional string nombre = 8;
  optional string codigo = 9;
  optional string descripcion = 10;
  optional IUbicacionGeografica ubicacion = 11;
  optional double radioCoberturaKm = 12;
  optional string idFuenteDatos = 13;
  optional double frecuenciaPollingMinutos = 14;
  optional string ultimaActualizacion = 15;
  optional string proximaActualizacionProgramada = 16;
  optional string estado = 17;
  optional string creadoPor = 18;
  optional string idPuntoMedicionOrigen = 19;
}

message IConfiguracionLectura {
  string tipoLectura = 1;
  double frecuenciaEsperada = 2;
  bool obligatoria = 3;
  optional string rangoValido = 4;
  optional double toleranciaRetraso = 5;
  optional string umbralCalidadMinima = 6;
  bool activa = 7;
  optional string fechaActivacion = 8;
  optional string fechaDesactivacion = 9;
  optional string descripcion = 10;
  optional string notas = 11;
}

message IMapeoVariable {
  string variableExterna = 1;
  optional string tipoVariableExterna = 2;
  string tipoLecturaDestino = 3;
  optional string transformacion = 4;
  optional double factorConversion = 5;
  optional string descripcion = 6;
  bool activo = 7;
}

message IConfiguracionIntegracion {
  string idFuenteDatos = 1;
  repeated IMapeoVariable mapaVariables = 2;
  string metodoSincronizacion = 3;
  optional double frecuenciaSincronizacion = 4;
  optional string configuracionProtocolo = 5;
  string estado = 6;
  optional string ultimaSincronizacionExitosa = 7;
  optional string ultimaSincronizacionIntento = 8;
  optional string proximaSincronizacionProgramada = 9;
  optional string ultimoError = 10;
  optional double contadorErroresConsecutivos = 11;
  optional string descripcion = 12;
  optional string notas = 13;
  bool activa = 14;
  optional string fechaActivacion = 15;
  optional string fechaDesactivacion = 16;
}

message IResumenUltimaLectura {
  string timestamp = 1;
  google.protobuf.Any valor = 2;
  string calidadDato = 3;
  optional google.protobuf.Struct valoresAdicionales = 4;
}

message IPuntoMedicion {
  optional string _id = 1;
  string idCliente = 2;
  optional string idDivision = 3;
  optional string idJefatura = 4;
  optional string idDistrito = 5;
  string nombre = 6;
  optional string codigo = 7;
  string tipo = 8;
  string funcionBalanceHidrico = 9;
  IUbicacionGeografica ubicacion = 10;
  string estado = 11;
  optional string fechaInstalacion = 12;
  optional string fechaDesactivacion = 13;
  repeated IConfiguracionLectura configuracionesLectura = 14;
  optional IConfiguracionIntegracion configuracionIntegracion = 15;
  optional google.protobuf.Struct ultimaLecturaPorTipo = 16;
  optional google.protobuf.Struct metadatosTecnicos = 17;
  optional string fechaCreacion = 18;
  optional google.protobuf.Any cliente = 19;
  optional google.protobuf.Any division = 20;
  optional google.protobuf.Any jefatura = 21;
  optional google.protobuf.Any distrito = 22;
}

message ICreatePuntoMedicion {
  string idCliente = 1;
  string nombre = 2;
  string tipo = 3;
  string funcionBalanceHidrico = 4;
  IUbicacionGeografica ubicacion = 5;
  string estado = 6;
  repeated IConfiguracionLectura configuracionesLectura = 7;
  optional string idDivision = 8;
  optional string idJefatura = 9;
  optional string idDistrito = 10;
  optional string codigo = 11;
  optional string fechaInstalacion = 12;
  optional string fechaDesactivacion = 13;
  optional IConfiguracionIntegracion configuracionIntegracion = 14;
  optional google.protobuf.Struct metadatosTecnicos = 15;
}

message IUpdatePuntoMedicion {
  optional google.protobuf.Struct ultimaLecturaPorTipo = 1;
  optional string idCliente = 2;
  optional string idDivision = 3;
  optional string idJefatura = 4;
  optional string idDistrito = 5;
  optional string nombre = 6;
  optional string codigo = 7;
  optional string tipo = 8;
  optional string funcionBalanceHidrico = 9;
  optional IUbicacionGeografica ubicacion = 10;
  optional string estado = 11;
  optional string fechaInstalacion = 12;
  optional string fechaDesactivacion = 13;
  repeated IConfiguracionLectura configuracionesLectura = 14;
  optional IConfiguracionIntegracion configuracionIntegracion = 15;
  optional google.protobuf.Struct metadatosTecnicos = 16;
}

message IRelacionTopologica {
  optional string _id = 1;
  string idCliente = 2;
  optional string idDistrito = 3;
  string idPuntoOrigen = 4;
  string idPuntoDestino = 5;
  string tipoRelacion = 6;
  optional double capacidadNominal = 7;
  optional double distanciaAproximada = 8;
  optional double diametroTuberia = 9;
  optional double prioridad = 10;
  string estado = 11;
  optional string fechaActivacion = 12;
  optional string fechaDesactivacion = 13;
  optional string descripcion = 14;
  optional string notas = 15;
  optional string fechaCreacion = 16;
  optional google.protobuf.Any puntoOrigen = 17;
  optional google.protobuf.Any puntoDestino = 18;
  optional google.protobuf.Any distrito = 19;
}

message ICreateRelacionTopologica {
  string idCliente = 1;
  string idPuntoOrigen = 2;
  string idPuntoDestino = 3;
  string tipoRelacion = 4;
  string estado = 5;
  optional string idDistrito = 6;
  optional double capacidadNominal = 7;
  optional double distanciaAproximada = 8;
  optional double diametroTuberia = 9;
  optional double prioridad = 10;
  optional string fechaActivacion = 11;
  optional string fechaDesactivacion = 12;
  optional string descripcion = 13;
  optional string notas = 14;
}

message IUpdateRelacionTopologica {
  optional string idDistrito = 1;
  optional string tipoRelacion = 2;
  optional double capacidadNominal = 3;
  optional double distanciaAproximada = 4;
  optional double diametroTuberia = 5;
  optional double prioridad = 6;
  optional string estado = 7;
  optional string fechaActivacion = 8;
  optional string fechaDesactivacion = 9;
  optional string descripcion = 10;
  optional string notas = 11;
}

message IUbicacionGeografica {
  google.protobuf.Struct geojson = 1;
  optional ose.datos.auxiliares.ICoordenadas coordenadas = 2;
  optional string direccionPostal = 3;
  optional string ciudad = 4;
  optional string departamento = 5;
  optional string barrio = 6;
  optional string codigoPostal = 7;
  optional string referenciasAdicionales = 8;
  optional string wkt = 9;
}


service EstacionClimaticaVirtualService {
  rpc Create(ICreateEstacionClimaticaVirtual) returns (IEstacionClimaticaVirtual);
  rpc Find(QueryRequest) returns (IEstacionClimaticaVirtualList);
  rpc FindById(IdRequest) returns (IEstacionClimaticaVirtual);
  rpc Update(UpdateEstacionClimaticaVirtualRequest) returns (IEstacionClimaticaVirtual);
  rpc Delete(IdRequest) returns (DeleteResponse);
}

message UpdateEstacionClimaticaVirtualRequest {
  string id = 1;
  IUpdateEstacionClimaticaVirtual data = 2;
}

message IEstacionClimaticaVirtualList {
  repeated IEstacionClimaticaVirtual items = 1;
  int32 total = 2;
}

service PuntoMedicionService {
  rpc Create(ICreatePuntoMedicion) returns (IPuntoMedicion);
  rpc Find(QueryRequest) returns (IPuntoMedicionList);
  rpc FindById(IdRequest) returns (IPuntoMedicion);
  rpc Update(UpdatePuntoMedicionRequest) returns (IPuntoMedicion);
  rpc Delete(IdRequest) returns (DeleteResponse);
}

message UpdatePuntoMedicionRequest {
  string id = 1;
  IUpdatePuntoMedicion data = 2;
}

message IPuntoMedicionList {
  repeated IPuntoMedicion items = 1;
  int32 total = 2;
}

service RelacionTopologicaService {
  rpc Create(ICreateRelacionTopologica) returns (IRelacionTopologica);
  rpc Find(QueryRequest) returns (IRelacionTopologicaList);
  rpc FindById(IdRequest) returns (IRelacionTopologica);
  rpc Update(UpdateRelacionTopologicaRequest) returns (IRelacionTopologica);
  rpc Delete(IdRequest) returns (DeleteResponse);
}

message UpdateRelacionTopologicaRequest {
  string id = 1;
  IUpdateRelacionTopologica data = 2;
}

message IRelacionTopologicaList {
  repeated IRelacionTopologica items = 1;
  int32 total = 2;
}

message QueryRequest {
  optional string filter = 1;
  optional int32 limit = 2;
  optional int32 skip = 3;
}

message IdRequest {
  string id = 1;
}

message DeleteResponse {
  bool success = 1;
  string message = 2;
}
